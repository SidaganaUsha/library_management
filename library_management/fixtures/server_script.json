[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-06-09 16:02:15.602482",
  "module": "library_management",
  "name": "Changing the Status is Returned if Article is Returned in Library Transaction",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Library Transaction",
  "script": "# setting the Status from Issued to Returned in Library Transaction Doctype when the Article is Returned\n\ndef validate(self):\n    if self.return_date:\n        self.status = \"Returned\"",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-06-09 16:26:59.537108",
  "module": "library_management",
  "name": "Set Article status to Available if Return Date is set in Library Transaction",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Library Transaction",
  "script": "# Auto-set status based on return_date\nif doc.return_date:\n    doc.status = \"Returned\"\nelse:\n    doc.status = \"Issued\"\n\n# Update Article status\nif not doc.article:\n    frappe.throw(\"No article linked to this transaction.\")\n\narticle = frappe.get_doc(\"Article\", doc.article)\n\nif doc.status == \"Issued\":\n    article.status = \"Issued\"\nelif doc.status == \"Returned\":\n    article.status = \"Available\"\n\narticle.save()\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-06-09 15:06:00.299893",
  "module": "library_management",
  "name": "Do not allow saving a Library Transaction if the linked Article status is Issued",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Library Transaction",
  "script": "if doc.status == \"Issued\":\n    article = frappe.get_doc(\"Article\", doc.article)\n\n    # Check if the article is already issued AND it's issued by a different transaction\n    existing_txn = frappe.get_all(\n        \"Library Transaction\",\n        filters={\n            \"article\": doc.article,\n            \"status\": \"Issued\",\n            \"name\": [\"!=\", doc.name]  # Exclude the current document\n        },\n        limit=1\n    )\n\n    if existing_txn:\n        frappe.throw(f\"The Article '{article.name}' is already issued to someone.\")\n",
  "script_type": "DocType Event"
 }
]